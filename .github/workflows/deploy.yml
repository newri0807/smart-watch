name: Deploy C#
on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: SSH Remote Commands
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_NAME }}
        key: ${{ secrets.SERVER_ACCESS_KEY }}
        script: |
          echo "ğŸš€ C# ë°°í¬ ì‹œì‘..."
          
          # 1. ìµœì‹  ì½”ë“œ ë°›ê¸°
          cd ~/deploy/repo-smartwatch
          git pull origin main

          # 2. ì‹¤í–‰ ìœ„ì¹˜ ì´ë™
          cd ~/deploy
          
          # 3. .envì— í‚¤ ì¶”ê°€ (ë®ì–´ì“°ê¸° ë°©ì§€ ë¡œì§)
          # ì´ë¯¸ í‚¤ê°€ ìˆìœ¼ë©´ ì§€ìš°ê³  ë‹¤ì‹œ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
          sed -i '/SMARTWATCH_API_KEY/d' .env
          echo "SMARTWATCH_API_KEY=${{ secrets.SMARTWATCH_API_KEY }}" >> .env

          # 4. ë„ì»¤ ì¬ì‹œì‘
          docker compose up -d --build smart-watch
          
          echo "âœ… C# ë°°í¬ ì™„ë£Œ!"
