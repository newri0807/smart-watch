name: Deploy C#
on:
  push:
    branches: [ "main" ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: SSH Remote Commands
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.KEY }}
        script: |
          echo "ðŸš€ C# ë°°í¬ ì‹œìž‘..."
          cd ~/deploy/repo-smartwatch
          git pull origin main

          # .envì— C# API í‚¤ ì¶”ê°€/ì—…ë°ì´íŠ¸
          cd ~/deploy
          if grep -q "SMARTWATCH_API_KEY=" .env; then
            sed -i "s/^SMARTWATCH_API_KEY=.*/SMARTWATCH_API_KEY=${{ secrets.SMARTWATCH_API_KEY }}/" .env
          else
            echo "SMARTWATCH_API_KEY=${{ secrets.SMARTWATCH_API_KEY }}" >> .env
          fi

          docker compose up -d --build --no-deps smart-watch
